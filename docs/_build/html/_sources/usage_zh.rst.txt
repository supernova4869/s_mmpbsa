使用指南
========

本文档详细介绍s_mmpbsa的各项功能和使用方法，帮助您深入了解并充分利用该工具进行结合自由能计算。

命令行参数
----------

s_mmpbsa支持以下命令行参数：

.. code-block:: bash
   
   # 基本用法
   s_mmpbsa [options] [tpr文件]
   
   # 选项
   --version   显示版本信息

交互式命令行界面
----------------

s_mmpbsa的交互式命令行界面分为以下几个主要部分：

1. **文件加载**：加载tpr、xtc和ndx文件
2. **轨迹参数设置**：设置受体、配体组和时间间隔等
3. **MM/PB-SA参数设置**：设置计算相关的各种参数
4. **计算执行**：执行MM/PB-SA计算
5. **结果分析**：分析和可视化计算结果

下面详细介绍每个部分的操作方法和参数设置。

文件加载
--------

在启动s_mmpbsa后，首先需要加载必要的输入文件：

- **tpr文件**：Gromacs的拓扑参数文件，包含系统的拓扑信息和原子参数
- **xtc文件**：Gromacs的轨迹文件，包含系统的坐标信息
- **ndx文件**：Gromacs的索引文件，包含系统的分组信息

加载文件的示例操作：

.. code-block:: bash
   
   # 输入tpr文件路径（可以是绝对路径或相对路径）
   md.tpr
   
   # 选择加载xtc文件
   1
   md_centered.xtc  # 输入xtc文件路径，按回车使用默认的md.xtc
   
   # 选择加载ndx文件
   2
   index.ndx  # 输入ndx文件路径，按回车使用默认的index.ndx
   
   # 进入下一步
   0

轨迹参数设置
------------

加载文件后，需要设置轨迹参数，主要包括：

- **受体组**：选择哪个组作为受体
- **配体组**：选择哪个组作为配体
- **时间间隔**：设置分析的时间间隔
- **跳过的帧数**：设置开始分析前跳过的帧数
- **结束分析的时间点**：设置结束分析的时间点

设置轨迹参数的示例操作：

.. code-block:: bash
   
   # 选择受体组
   1
   1  # 输入受体组的编号，例如1表示Protein组
   
   # 选择配体组
   2
   13  # 输入配体组的编号，例如13表示配体
   
   # 设置起点时间
   3
   0  # 输入要跳过的帧数，默认为0
   
   # 设置终点时间
   4
   0  # 输入结束时间点，0表示分析到轨迹结束
   
   # 设置时间间隔（单位：ns）
   5
   1  # 输入时间间隔，例如1表示每1ns分析一次
   
   # 进入下一步
   0

MM/PB-SA参数设置
--------------

接下来，设置MM/PB-SA计算的相关参数。s_mmpbsa提供了多种参数设置选项：

.. code-block:: bash
   
   # 显示当前参数设置
   1
   
   # 设置温度（单位：K）
   2
   298.15  # 输入温度，默认为298.15K
   
   # 设置NaCl浓度（单位：mol/L）
   3
   0.15  # 输入KCl浓度，默认为0.15mol/L
   
   # 设置盐桥搜索距离（单位：Å）
   4
   4.0  # 输入盐桥搜索距离，默认为4.0Å
   
   # 设置氢键搜索距离（单位：Å）
   5
   3.5  # 输入氢键搜索距离，默认为3.5Å
   
   # 设置范德华截断距离（单位：Å）
   6
   14.0  # 输入范德华截断距离，默认为14.0Å
   
   # 设置MM计算的并行核数
   7
   4  # 输入并行核数，默认为系统CPU核心数
   
   # 设置PB参数
   8
   # 输入PB参数设置子菜单（详见下文）
   
   # 设置SA参数
   9
   # 输入SA参数设置子菜单（详见下文）
   
   # 进入下一步
   0

PB参数设置
~~~~~~~~~

在PB参数设置子菜单中，可以设置以下参数：

.. code-block:: bash
   
   # 显示当前PB参数设置
   1
   
   # 设置溶剂介电常数
   2
   78.54  # 输入溶剂介电常数，默认为78.54
   
   # 设置溶质介电常数
   3
   1.0  # 输入溶质介电常数，默认为1.0
   
   # 设置网格间距（单位：Å）
   4
   0.5  # 输入网格间距，默认为0.5Å
   
   # 设置APBS可执行文件路径
   5
   /usr/local/bin/apbs  # 输入APBS可执行文件路径，按回车使用内置路径
   
   # 返回上一级菜单
   0

SA参数设置
~~~~~~~~~

在SA参数设置子菜单中，可以设置以下参数：

.. code-block:: bash
   
   # 显示当前SA参数设置
   1
   
   # 设置表面张力（单位：kJ/(mol·Å²)）
   2
   0.0379  # 输入表面张力，默认为0.0379 kJ/(mol·Å²)
   
   # 设置非极性溶剂化参数（单位：kJ/(mol·Å³)）
   3
   0.0  # 输入非极性溶剂化参数，默认为0.0 kJ/(mol·Å³)
   
   # 设置SAS计算方法（0：Shrake-Rupley，1：MSMS）
   4
   0  # 输入SAS计算方法，默认为0（Shrake-Rupley）
   
   # 返回上一级菜单
   0

执行计算
--------

设置完成后，开始执行MM/PB-SA计算。在计算前，需要输入系统名称：

.. code-block:: bash
   
   # 输入系统名称
   system  # 输入系统名称，默认为system
   
   # 计算过程中会显示进度条和当前能量值
   # 计算完成后，会自动进入分析模式

结果分析
--------

计算完成后，可以进行结果分析。s_mmpbsa提供了多种分析选项：

.. code-block:: bash
   
   # 生成包含残基结合能信息的pdb文件
   -1
   0  # 输入时间点，0表示平均值
   
   # 查看结果摘要
   1
   
   # 输出能量随时间变化的数据
   2
   
   # 输出特定时间点的残基结合能
   3
   0  # 输入时间点，0表示平均值
   1  # 选择输出3Å范围内的残基（0：全部残基，1：3Å范围，2：5Å范围，3：10Å范围）
   
   # 输出配体原子的结合能
   4
   
   # 输出氢键和盐桥信息
   5
   
   # 输出相互作用能矩阵
   6
   
   # 退出程序
   0

使用分析模式
------------

s_mmpbsa还提供了专门的分析模式，可以对已计算的结果进行重新分析，而无需重新计算：

.. code-block:: bash
   
   # 启动分析模式
   s_mmpbsa
   a  # 在交互式界面中输入a进入分析模式
   
   # 输入工作目录路径
   ./results  # 输入包含.sm结果文件的目录，默认为当前目录
   
   # 输入温度（单位：K）
   298.15  # 输入温度，默认为298.15K
   
   # 输入系统名称
   system  # 输入之前计算时使用的系统名称，默认为system
   
   # 之后的分析操作与正常计算完成后的分析操作相同

丙氨酸扫描
----------

s_mmpbsa还支持丙氨酸扫描功能，可以系统性地将蛋白质残基突变为丙氨酸，并计算突变前后的结合自由能变化。

进行丙氨酸扫描的步骤如下：

.. code-block:: bash
   
   # 准备工作目录
   mkdir -p ala_scan
   cd ala_scan
   
   # 复制必要的输入文件
   cp ../md.tpr ../md_centered.xtc ../index.ndx .
   
   # 执行丙氨酸扫描
   s_mmpbsa md.tpr
   1
   md_centered.xtc
   2
   index.ndx
   0
   1
   1  # 选择受体组（蛋白质）
   2
   13  # 选择配体组
   5
   1
   0
   0
   system  # 系统名称
   -1  # 生成pdb文件（可选）
   0  # 退出分析
   a  # 进入分析模式
   .  # 使用当前目录
   298.15  # 温度
   system  # 系统名称
   0  # 退出分析
   
   # 现在可以查看丙氨酸扫描的结果

计算结果解读
------------

s_mmpbsa的计算结果主要包括以下能量项：

- **ΔG_bind**：总结合自由能
- **ΔH**：焓变
- **TΔS**：熵贡献（注意：s_mmpbsa目前不直接计算熵，此值通常设为0或通过其他方法估算）
- **ΔE_vdw**：范德华相互作用能
- **ΔE_elec**：静电相互作用能
- **ΔG_polar**：极性溶剂化自由能
- **ΔG_nonpolar**：非极性溶剂化自由能

结合自由能的负值越大，表示结合越强。通常，ΔG_bind < -10 kJ/mol表示较强的结合。

注意事项
--------

在使用s_mmpbsa时，需要注意以下几点：

1. **轨迹质量**：确保轨迹质量良好，已正确处理PBC、中心化和拟合等操作。

2. **索引文件**：确保索引文件包含正确的受体和配体组。

3. **参数选择**：对于不同的系统，可能需要调整参数以获得更准确的结果。

4. **并行计算**：在settings.ini中设置适当的nkernels值，可以利用多核CPU加速计算。

5. **结果验证**：建议与实验数据或其他计算方法的结果进行比较，验证计算结果的可靠性。

更多信息
--------

- :doc:`quick_start`：快速入门指南
- :doc:`installation`：安装说明
- :doc:`api`：API文档（适用于开发者）
- :doc:`faq`：常见问题解答