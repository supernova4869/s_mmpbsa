快速入门
========

本文档提供s_mmpbsa的基本使用流程，帮助您快速上手该工具进行结合自由能计算。

启动s_mmpbsa
------------

安装完成后，可以通过以下方式启动s_mmpbsa：

.. code-block:: bash
   
   # 在命令行中直接运行
   s_mmpbsa
   
   # 或者直接指定tpr文件路径
   s_mmpbsa md.tpr

启动后，您将看到s_mmpbsa的欢迎信息，然后进入交互式界面。

基本工作流程
------------

s_mmpbsa的基本工作流程包括以下几个步骤：

1. 加载输入文件（tpr、xtc和ndx文件）
2. 设置轨迹参数（选择受体和配体组）
3. 设置MM/PB-SA参数
4. 执行计算
5. 分析结果

下面我们将详细介绍每个步骤的操作方法。

加载输入文件
------------

启动s_mmpbsa后，首先需要加载必要的输入文件：

.. code-block:: bash
   
   # 输入tpr文件路径
   md.tpr
   
   # 加载xtc文件（选项1）
   1
   md_centered.xtc  # 如果轨迹已处理过PBC，可以直接输入；否则按回车使用默认的md.xtc
   
   # 加载ndx文件（选项2）
   2
   index.ndx  # 按回车使用默认的index.ndx
   
   # 进入下一步（选项0）
   0

设置轨迹参数
------------

加载输入文件后，需要设置轨迹参数，主要是选择受体和配体组：

.. code-block:: bash
   
   # 选择受体组（选项1）
   1
   [选择受体组的编号，例如1表示Protein]
   
   # 选择配体组（选项2）
   2
   [选择配体组的编号，例如13表示配体]
   
   # 设置时间间隔（选项5），通常每1ns分析一次
   5
   1  # 时间间隔，单位为ns
   
   # 进入下一步（选项0）
   0

设置MM/PB-SA参数
--------------

接下来，设置MM/PB-SA计算的相关参数：

.. code-block:: bash
   
   # 通常情况下，使用默认参数即可
   # 如需修改PB参数，可以选择选项8
   # 如需修改SA参数，可以选择选项9
   
   # 进入下一步（选项0）
   0

执行计算
--------

设置完成后，开始执行计算：

.. code-block:: bash
   
   # 输入系统名称（默认为system）
   [按回车使用默认名称或输入自定义名称]
   
   # 等待计算完成
   # 计算过程中会显示进度条和当前能量值

分析结果
--------

计算完成后，可以进行结果分析：

.. code-block:: bash
   
   # 生成包含残基结合能信息的pdb文件（选项-1）
   -1
   [按回车使用默认时间点（平均值）或输入特定时间点]
   
   # 查看结果摘要（选项1）
   1
   
   # 输出能量随时间变化的数据（选项2）
   2
   
   # 输出特定时间点的残基结合能（选项3）
   3
   [按回车使用默认时间点（平均值）或输入特定时间点]
   1  # 选择输出3Å范围内的残基
   
   # 输出配体原子的结合能（选项4）
   4
   
   # 退出程序（选项0）
   0

使用分析模式
------------

s_mmpbsa还提供了专门的分析模式，可以对已计算的结果进行重新分析：

.. code-block:: bash
   
   # 启动分析模式
   s_mmpbsa
   a  # 输入a进入分析模式
   
   # 输入工作目录路径（默认为当前目录）
   [按回车使用当前目录或输入包含.sm结果文件的目录]
   
   # 输入温度（默认为298.15K）
   [按回车使用默认温度或输入自定义温度]
   
   # 输入系统名称（默认为system）
   [按回车使用默认名称或输入之前计算时使用的系统名称]
   
   # 之后的分析操作与正常计算完成后的分析操作相同

示例：计算蛋白质-配体结合能
-------------------------

下面是一个计算蛋白质-配体结合能的完整示例：

.. code-block:: bash
   
   # 启动s_mmpbsa并加载文件
   s_mmpbsa
   md.tpr
   1
   md_centered.xtc
   2
   index.ndx
   0
   
   # 设置轨迹参数
   1
   1  # 假设1是Protein组
   2
   13  # 假设13是配体组
   5
   1
   0
   
   # 设置MM/PB-SA参数（使用默认值）
   0
   
   # 执行计算
   protein_ligand  # 系统名称
   
   # 分析结果
   -1
   1
   2
   3
   1
   4
   0

使用技巧
--------

1. **轨迹准备**：在计算前，建议使用Gromacs的trjconv工具对轨迹进行处理，包括去除PBC、中心化和拟合等操作，以获得更好的计算结果。

2. **索引文件**：确保索引文件包含正确的受体和配体组。如果没有现成的索引文件，可以使用Gromacs的make_ndx工具创建。

3. **时间间隔**：对于长时间的MD模拟，可以适当增加时间间隔，减少计算量。通常每1-2ns分析一次即可获得较好的统计结果。

4. **并行计算**：在settings.ini中设置适当的nkernels值，可以利用多核CPU加速计算。

5. **结果可视化**：生成的pdb文件可以用PyMOL等软件打开，查看残基结合能的分布情况（通过B因子着色）。

常见问题解答
----------

### 如何处理大型系统？

对于大型系统，可以尝试以下优化措施：

- 增加时间间隔，减少分析的帧数
- 增加nkernels值，利用更多CPU核心
- 使用较小的截断距离（通过修改r_cutoff参数）

### 如何提高计算精度？

提高计算精度的方法包括：

- 确保轨迹质量良好，已正确处理PBC
- 增加采样点数，即减小时间间隔
- 调整PB参数，如网格大小、溶剂介电常数等

### 计算结果如何解读？

结合自由能的负值越大，表示结合越强。通常，计算结果会给出以下能量项：

- ΔG_bind：总结合自由能
- ΔH：焓变
- TΔS：熵贡献
- ΔE_vdw：范德华相互作用能
- ΔE_elec：静电相互作用能
- ΔG_polar：极性溶剂化自由能
- ΔG_nonpolar：非极性溶剂化自由能

更多详细信息，请参考 :doc:`usage` 章节。